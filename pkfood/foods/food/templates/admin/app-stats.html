{% extends 'admin/base_site.html' %}

{% block content %}
<h1>Statistics for Orders in {{ year }}</h1>

<!-- Biểu đồ số lượng đơn hàng -->
<div>
    <h2>Number of Orders by Month</h2>
    <canvas id="orderCountChart" width="400" height="200"></canvas>
</div>

<!-- Biểu đồ doanh thu -->
<div>
    <h2>Revenue by Month</h2>
    <canvas id="revenueChart" width="400" height="200"></canvas>
</div>

<!-- Biểu đồ số lần đặt món ăn -->
<div>
    <h2>Food Orders by Month</h2>
    <canvas id="foodOrderChart" width="400" height="200"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Chuyển đổi chuỗi JSON thành đối tượng JavaScript
    const orderCountLabels = JSON.parse('{{ order_count_labels|safe }}');
    const orderCountData = JSON.parse('{{ order_count_data|safe }}');
    const revenueLabels = JSON.parse('{{ revenue_labels|safe }}');
    const revenueData = JSON.parse('{{ revenue_data|safe }}');
    const foodOrderLabels = JSON.parse('{{ food_order_labels|safe }}');
    const foodOrderData = JSON.parse('{{ food_order_data|safe }}');

    // Dữ liệu và cấu hình biểu đồ số lượng đơn hàng
    const orderCountChartData = {
        labels: orderCountLabels,
        datasets: [{
            label: 'Number of Orders',
            data: orderCountData,
            backgroundColor: orderCountLabels.map(() => {
                let r = Math.random() * 255;
                let g = Math.random() * 255;
                let b = Math.random() * 255;
                return `rgba(${r},${g},${b}, 0.3)`;
            }),
            borderColor: orderCountLabels.map(() => {
                let r = Math.random() * 255;
                let g = Math.random() * 255;
                let b = Math.random() * 255;
                return `rgba(${r},${g},${b}, 1)`;
            }),
            borderWidth: 1
        }]
    };

    // Dữ liệu và cấu hình biểu đồ doanh thu
    const revenueChartData = {
        labels: revenueLabels,
        datasets: [{
            label: 'Revenue',
            data: revenueData,
            backgroundColor: revenueLabels.map(() => {
                let r = Math.random() * 255;
                let g = Math.random() * 255;
                let b = Math.random() * 255;
                return `rgba(${r},${g},${b}, 0.3)`;
            }),
            borderColor: revenueLabels.map(() => {
                let r = Math.random() * 255;
                let g = Math.random() * 255;
                let b = Math.random() * 255;
                return `rgba(${r},${g},${b}, 1)`;
            }),
            borderWidth: 1
        }]
    };

    // Dữ liệu và cấu hình biểu đồ số lần đặt món ăn
    const foodOrderChartData = {
        labels: foodOrderLabels,
        datasets: [{
            label: 'Food Orders',
            data: foodOrderData,
            backgroundColor: foodOrderLabels.map(() => {
                let r = Math.random() * 255;
                let g = Math.random() * 255;
                let b = Math.random() * 255;
                return `rgba(${r},${g},${b}, 0.3)`;
            }),
            borderColor: foodOrderLabels.map(() => {
                let r = Math.random() * 255;
                let g = Math.random() * 255;
                let b = Math.random() * 255;
                return `rgba(${r},${g},${b}, 1)`;
            }),
            borderWidth: 1
        }]
    };

    // Vẽ biểu đồ số lượng đơn hàng
    const ctx1 = document.getElementById('orderCountChart').getContext('2d');
    new Chart(ctx1, {
        type: 'bar',
        data: orderCountChartData,
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    // Vẽ biểu đồ doanh thu
    const ctx2 = document.getElementById('revenueChart').getContext('2d');
    new Chart(ctx2, {
        type: 'bar',
        data: revenueChartData,
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    // Vẽ biểu đồ số lần đặt món ăn
    const ctx3 = document.getElementById('foodOrderChart').getContext('2d');
    new Chart(ctx3, {
        type: 'bar',
        data: foodOrderChartData,
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>

<form method="get" action="">
    <label for="year">Select Year:</label>
    <input type="number" id="year" name="year" value="{{ year }}">
    <button type="submit">Filter</button>
</form>
{% endblock %}
